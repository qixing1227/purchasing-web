# 在线采购商城系统 (Purchasing Web) 实验报告

## 1. 项目简介

本项目“Purchasing Web”是一个基于 B/S 架构的全功能在线采购商城系统。项目旨在模拟真实的电子商务环境，提供从用户注册登录、商品浏览、购物车管理、订单生成到支付模拟的完整购物流程。同时，系统配备了功能完善的管理员后台，支持商品管理、销售数据统计以及系统操作日志审计，满足了B2C/B2B场景下的基本采购需求。

## 2. 技术选型

本项目采用现代化的 **MERN** 技术栈进行开发，实现了前后端分离的架构设计。

*   **前端 (Client)**:
    *   **框架**: React (v19) - 用于构建用户界面的 JavaScript 库。
    *   **构建工具**: Vite - 提供极速的开发服务器和打包构建。
    *   **样式**: Tailwind CSS - 实用优先的 CSS 框架，用于快速构建响应式界面。
    *   **路由**: React Router v7 - 处理单页应用的路由导航。
    *   **状态管理**: React Context API - 用于管理全局状态（如用户认证、购物车）。
    *   **HTTP 请求**: Axios - 用于与后端 API 进行交互。

*   **后端 (Server)**:
    *   **运行环境**: Node.js - 基于 Chrome V8 引擎的 JavaScript 运行环境。
    *   **Web 框架**: Express - 快速、极简的 Node.js Web 开发框架。
    *   **数据库**: MongoDB - 基于文档的 NoSQL 数据库，存储灵活的数据结构。
    *   **ORM**: Mongoose - 用于在 Node.js 中对 MongoDB 进行对象建模。
    *   **认证**: JSON Web Token (JWT) - 用于无状态的用户身份验证。

## 3. 系统设计

### 3.1 数据库设计

系统使用 MongoDB 存储数据，主要包含以下核心数据模型：

1.  **User (用户)**:
    *   存储用户基本信息（姓名、邮箱、密码哈希）。
    *   `role`: 区分用户角色（普通用户 customer / 管理员 admin）。
    *   `addresses`: 存储用户的收货地址列表。
    *   `isVerified`: 邮箱验证状态。

2.  **Product (商品)**:
    *   存储商品详情（名称、描述、价格、库存、图片链接）。

3.  **Order (订单)**:
    *   关联用户和商品。
    *   存储订单状态（是否支付、是否发货）、支付方式、总金额、收货地址信息。
    *   `orderItems`: 包含订单中每个商品的快照信息。

4.  **Review (评价)**:
    *   关联用户和商品。
    *   存储评分（1-5分）和评论内容。

5.  **Log (日志)**:
    *   记录系统关键操作（如登录、下单、修改商品）。
    *   包含操作人、动作类型、目标对象ID及详细信息，用于审计。

### 3.2 API 接口设计

后端遵循 RESTful 风格设计 API，主要接口如下：

*   **认证模块 (`/api/auth`)**:
    *   `POST /register`: 用户注册。
    *   `POST /login`: 用户登录。
    *   `POST /verify`: 邮箱验证码验证。

*   **商品模块 (`/api/products`)**:
    *   `GET /`: 获取商品列表。
    *   `GET /:id`: 获取商品详情。
    *   `POST /`: 添加商品 (Admin)。
    *   `PUT /:id`: 更新商品 (Admin)。
    *   `DELETE /:id`: 删除商品 (Admin)。

*   **订单模块 (`/api/orders`)**:
    *   `POST /`: 创建新订单。
    *   `GET /myorders`: 获取当前用户的历史订单。
    *   `GET /admin/stats`: 获取销售统计数据 (Admin)。

*   **用户模块 (`/api/users`)**:
    *   `GET /profile`: 获取个人信息。
    *   `PUT /profile`: 更新个人信息。

*   **日志模块 (`/api/logs`)**:
    *   `GET /`: 获取系统操作日志 (Admin)。

## 4. 功能实现与关键代码

### 4.1 用户认证与权限控制
系统使用 JWT 进行身份验证。`authMiddleware` 中间件用于保护私有路由，解析请求头中的 Token 并验证用户身份。

**关键代码 (`server/middleware/authMiddleware.js`):**
```javascript
const protect = async (req, res, next) => {
    let token;
    if (req.headers.authorization && req.headers.authorization.startsWith('Bearer')) {
        try {
            token = req.headers.authorization.split(' ')[1];
            const decoded = jwt.verify(token, process.env.JWT_SECRET);
            req.user = await User.findById(decoded.user.id).select('-password');
            next();
        } catch (error) {
            res.status(401).json({ msg: '未授权，Token 失败' });
        }
    }
    if (!token) {
        res.status(401).json({ msg: '未授权，没有 Token' });
    }
};
```

### 4.2 购物车功能
前端使用 React Context (`CartContext`) 全局管理购物车状态，支持商品添加、数量调整及持久化存储（LocalStorage）。

**关键代码 (`client/src/context/CartContext.jsx`):**
```javascript
// 添加商品到购物车逻辑
const addToCart = (product) => {
    if (!user) {
        toast.error('请先登录或注册账号');
        return;
    }
    setCartItems((prevItems) => {
        const existingItem = prevItems.find((item) => item._id === product._id);
        if (existingItem) {
            return prevItems.map((item) =>
                item._id === product._id
                    ? { ...item, quantity: item.quantity + 1 }
                    : item
            );
        } else {
            return [...prevItems, { ...product, quantity: 1 }];
        }
    });
};
```

### 4.3 订单处理
后端 `orderController` 接收前端提交的订单数据，验证库存并生成订单记录，同时扣减相应商品的库存。

## 5. 系统测试与演示

*(此处请插入以下截图)*

1.  **首页展示**: 展示商品列表页面的截图。
2.  **用户注册/登录**: 展示登录表单及验证功能的截图。
3.  **购物车页面**: 展示添加商品后的购物车界面。
4.  **订单确认与支付**: 展示填写地址及模拟支付成功的界面。
5.  **个人中心**: 展示用户个人信息及历史订单列表。
6.  **管理员仪表盘**: 展示销售数据统计图表的截图。
7.  **商品管理后台**: 展示管理员添加或编辑商品的界面。
8.  **系统日志**: 展示管理员查看操作日志的界面。

## 6. 实验总结

通过本次实验，我完整地设计并实现了一个基于 MERN 栈的在线采购商城系统。
1.  **掌握了全栈开发流程**: 从数据库设计、后端 API 开发到前端页面构建及交互逻辑实现。
2.  **深入理解了前后端交互**: 熟练使用了 Axios 进行数据请求，并处理了跨域、Token 认证等常见问题。
3.  **提升了工程化能力**: 使用 Vite 进行构建，ESLint 进行代码规范检查，并实现了组件化开发。
4.  **解决了实际问题**: 在开发过程中遇到了状态管理同步、图片资源加载等问题，通过查阅文档和调试最终得以解决。

该系统目前已具备核心电商功能，未来可进一步扩展支付网关集成、实时物流追踪等高级功能。
